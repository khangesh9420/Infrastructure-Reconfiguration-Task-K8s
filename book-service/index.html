<!DOCTYPE html>
<html>
<head>
  <title>Welcome to DevOps World</title>
</head>
<body>
  <h1> Welcome to DevOps World</h1>
  <p>Register below to join our DevOps course!</p>

  <form id="register-form">
    <label for="name">Your Name:</label>
    <input type="text" id="name" required />
    <button type="submit">Register</button>
  </form>

  <h2>ðŸ“‹ Registered Users</h2>
  <ul id="registrants-list"></ul>

  <script>
    async function loadRegistrants() {
      try {
        const res = await fetch('/registrants');
        if (!res.ok) throw new Error('Failed to fetch registrants');
        const names = await res.json();
        const list = document.getElementById('registrants-list');
        list.innerHTML = '';
        names.forEach(name => {
          const li = document.createElement('li');
          li.textContent = name;
          list.appendChild(li);
        });
      } catch (err) {
        alert('Error loading registrants: ' + err.message);
      }
    }

    document.getElementById('register-form').onsubmit = async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      if (!name) return alert('Please enter your name.');

      try {
        const res = await fetch('/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name })
        });

        if (!res.ok) {
          const error = await res.json();
          throw new Error(error.error || 'Registration failed');
        }

        await loadRegistrants();
        document.getElementById('name').value = '';
      } catch (err) {
        alert('Error: ' + err.message);
      }
    };

    // Load registrants on page load
    loadRegistrants();
  </script>
</body>
</html>
